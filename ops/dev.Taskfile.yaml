version: "3"

tasks:
  generate-dev-env:
    vars:
      ROOT_DOMAIN: "local"
      SHOP_NAME: "demo"
      NODE_ENV: "development"
    env:
      NEXT_PUBLIC_ROOT_DOMAIN: "{{.ROOT_DOMAIN}}"
      NEXT_PUBLIC_SHOP_NAME: "{{.SHOP_NAME}}"
      NODE_ENV: "{{.NODE_ENV}}"
    cmds:
      - bash ./ops/scripts/generate-dev-env.sh

  generate-almost-prod-like-env:
    requires:
      vars:
        - "ROOT_DOMAIN"
        - "SHOP_NAME"
        - "NODE_ENV"
    env:
      NEXT_PUBLIC_ROOT_DOMAIN: "{{.ROOT_DOMAIN}}"
      NEXT_PUBLIC_SHOP_NAME: "{{.SHOP_NAME}}"
      NODE_ENV: "{{.NODE_ENV}}"
    cmds:
      - bash ./ops/scripts/generate-almost-prod-like-env.sh

  generate-prod-env:
    requires:
      vars:
        - "ROOT_DOMAIN"
        - "SHOP_NAME"
        - "NODE_ENV"
    env:
      NEXT_PUBLIC_ROOT_DOMAIN: "{{.ROOT_DOMAIN}}"
      NEXT_PUBLIC_SHOP_NAME: "{{.SHOP_NAME}}"
      SHOP_NAME: "{{.SHOP_NAME}}"
      NODE_ENV: "{{.NODE_ENV}}"
    cmds:
      - rm -rf .env
      - bash ./ops/scripts/generate-prod-env.sh
      - source .env
